# VAGUS APP â€” PRE-IMPLEMENTATION AUDIT

**Date:** 2025-01-XX  
**Auditor:** Cursor AI (Non-Destructive Mode)  
**PDF Source:** `docs/vagus TOP-SECRET .pdf`  
**Status:** READY FOR IMPLEMENTATION

---

## A) PDF â†’ "ENHANCEMENTS LIST" (EXTRACTED)

*Note: PDF is binary format. Section titles extracted via grep. Full numbered enhancements require PDF text extraction library. Below are enhancements identified from section structure and codebase cross-reference.*

### A) LIVING COACH SYSTEMS

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| A | I | Coach Daily Dominance | Coach dashboard shows critical actions and client status at a glance |
| A | II | Client Intelligence | Coach sees client patterns, compliance, and progress instantly |
| A | III | Communication Superpowers | Enhanced messaging with smart replies, context, and quick actions |
| A | IV | Knowledge & Memory | Coach notes with semantic search and contextual memory |
| A | V | Workout Control & Adaptation | Coach can modify workouts surgically without micromanaging |
| A | VI | Nutrition Control Without Micromanaging | Coach sets targets and rules, system adapts automatically |
| A | VII | Session & Calendar Mastery | Coach manages sessions, bookings, and calendar seamlessly |
| A | VIII | Multi-Client Management | Coach handles multiple clients efficiently with prioritization |
| A | IX | Coach Performance & Self-Care | Coach tracks own workload, burnout prevention, and self-improvement |
| A | X | Authority, Status & Trust | Coach profile, portfolio, and trust indicators without ego |
| A | XI | Stealth Power Features | Invisible features that make coaching effortless |

---

### B) BEHAVIOR & RETENTION WEAPONS

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| B | I | Daily Open! Immediate Dopamine | First 3 seconds of app open deliver instant gratification |
| B | II | Streaks That Don't Make People Quit | Streak system that prevents abandonment on missed days |
| B | III | Miss A Day? Prevent The Death Spiral | System prevents cascade of missed days after one failure |
| B | IV | Daily Missions = Addiction Engine | Daily tasks that feel rewarding, not burdensome |
| B | V | XP, Levels & Status | Gamification that feels mature, not childish |
| B | VI | Emotional Retention | Features that create emotional connection to the app |
| B | VII | Time & Progress Awareness | Make time feel heavy, show progress weight |
| B | VIII | Social Pressure Without Toxicity | Peer motivation without comparison or shame |
| B | IX | Decision Fatigue Killers | Reduce choices, automate decisions, simplify actions |
| B | X | Extreme Retention Weapons | Subtle psychological triggers that keep users engaged |

---

### C) CLIENT MISSION CONTROL DASHBOARD

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| C | I | Mission Control Dashboard | Dashboard that feels like a command center, not a list |
| C | II | Invisible Noticeability | Features work so well they're barely noticed |
| C | III | Alien-Level UX | Interface that feels advanced but not overwhelming |

---

### D) WORKOUT SUPERCOMPUTER

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| D | I | Workout = System, Not List | Hierarchical workout structure (plans â†’ weeks â†’ days â†’ exercises) |
| D | II | Set-Level Intelligence | Track RPE, RIR, tempo, rest, form quality per set |
| D | III | Exercise-Level Superpowers | Exercise library with videos, cues, substitutions, history |
| D | IV | Session Transformation Modes | Different workout modes (strength, hypertrophy, endurance, deload) |
| D | V | Weekly & Mesocycle Intelligence | Periodization, volume tracking, progression across weeks |
| D | VI | Progression Engine | Automated progression with 5+ periodization models |
| D | VII | Fatigue, Recovery & Readiness | Track fatigue, calculate recovery scores, suggest readiness |
| D | VIII | Technique & Execution | Form cues, execution quality tracking, video references |
| D | IX | Analytics That Actually Matter | Volume, PR detection, muscle balance, progression trends |
| D | X | Coach Control Layer | Coach can modify plans surgically without breaking structure |
| D | XI | Client Psychology Inside Workout | Motivation, encouragement, psychology during sessions |
| D | XII | Extreme / Alien But Still Real | Advanced features that feel like magic but are real |

---

### E) NUTRITION DOMINATION

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| E | I | Nutrition = Control System | Nutrition plans as adaptive systems, not static meal lists |
| E | II | Macros That Don't Make People Quit | Visual macro tracking that doesn't feel restrictive |
| E | III | Meal Systems That Feel Effortless | Meal prep, batch cooking, effortless meal planning |
| E | IV | Digestion, Bloat & Compliance | Track digestion quality, bloating, compliance factors |
| E | V | Electrolytes & Water | Track electrolytes, hydration, water intake with reminders |
| E | VI | Refeds, Diet Breaks & Adaptation | Scheduled refeeds, diet breaks, metabolic adaptation tracking |
| E | VII | Rest Days, Travel & Chaos Control | Nutrition plans adapt to rest days, travel, schedule chaos |
| E | VIII | Psychology & Adherence | Psychology features that improve nutrition adherence |
| E | IX | Coach Control Without Micromanagement | Coach sets rules, system adapts automatically |
| E | X | Analytics That Actually Matter | Nutrition analytics that drive behavior change |
| E | XI | Extreme / Alien But Real | Advanced nutrition features that feel effortless |
| E | XII | Final Insane Layer | Edge features that create unfair advantage |

---

### F) MESSAGING WEAPON

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| F | I | Real-time Messaging | Instant messaging with typing indicators and read receipts |
| F | II | Message Threading | Organized message threads with parent-child relationships |
| F | III | AI Smart Replies | Context-aware reply suggestions based on conversation |
| F | IV | Message Pinning | Pin important messages for quick access |
| F | V | Message Search | Search messages by text and semantic similarity |
| F | VI | Translation Support | Translate messages to user's preferred language |
| F | VII | Quick Actions | Quick booking, reschedule, and action buttons in messages |
| F | VIII | Message Attachments | Attach files, images, workout plans to messages |
| F | IX | Message Reactions | React to messages with emojis |
| F | X | Message Threading UI | Clean thread view with conversation history |

---

### G) NOTES + EMBEDDINGS SECOND BRAIN

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| G | I | Core Idea | Notes become searchable knowledge base with embeddings |
| G | II | Knowledge Ingestion | Ingest notes, messages, workout data into knowledge base |
| G | III | Semantic Search | Search notes by meaning, not just keywords |
| G | IV | Contextual Memory Surfacing | Surface relevant notes automatically based on context |
| G | V | Knowledge Structuring | Organize knowledge into structured, queryable format |
| G | VI | Knowledge â†’ Action | Convert knowledge into actionable items automatically |
| G | VII | Coach Second Brain UI | UI that makes coach notes feel like a second brain |
| G | VIII | Client-Facing Knowledge | Share controlled knowledge with clients safely |
| G | IX | Embeddings as Compression | Use embeddings to compress and search knowledge |
| G | X | Coach Learning & Self-Improvement | Coach learns from notes and improves over time |
| G | XI | Admin / System Intelligence | System uses knowledge for admin decisions |
| G | XII | Alien-Level But Still Real | Advanced knowledge features that feel magical |
| G | XIII | Final Edge | Edge features that create unfair advantage |

---

### H) CALENDAR PREMIUM SCHEDULING

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| H | I | Calendar Views | Month, week, and day views with smooth navigation |
| H | II | Event CRUD | Create, read, update, delete calendar events |
| H | III | Recurring Events | Recurring events with RRULE support |
| H | IV | Booking System | Client booking system with availability management |
| H | V | Reminders | Local and push notifications for events |
| H | VI | Event Tags | Tag events for organization and filtering |
| H | VII | File Attachments | Attach files to calendar events |
| H | VIII | AI Event Tagging | Auto-suggest tags for events using AI |
| H | IX | Conflict Detection | Detect and prevent booking conflicts |
| H | X | Session & Calendar Mastery | Integrate workout sessions with calendar |

---

### I) PROGRESS & ANALYTICS DOPAMINE

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| I | I | Progress Charts | Visual progress charts that show trends over time |
| I | II | Compliance Tracking | Track compliance with plans and goals |
| I | III | Check-in Calendar | Calendar view of check-ins and progress entries |
| I | IV | Coach Feedback | Coach can provide feedback on progress |
| I | V | Progress Analytics | Analytics that turn data into dopamine hits |
| I | VI | Progress Export | Export progress data to PDF or images |

---

### J) VIRAL & SHARE LOOPS

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| J | I | Core Principle | Virality without social media dependency |
| J | II | Passive Virality | Features that naturally encourage sharing without asking |
| J | III | Social Proof Without Comparison | Show social proof without toxic comparison |
| J | IV | Referrals That Don't Feel Like Referrals | Referral system that feels natural, not pushy |
| J | V | Share Inside Private Spaces | Share within coach-client relationship, not public feeds |
| J | VI | Virality Through Coaches | Coaches become viral distribution channel |
| J | VII | Scarcity & Exclusivity | Create scarcity and exclusivity without being manipulative |
| J | VIII | Shareable Identity | Share identity and journey, not just results |
| J | IX | Viral Loops Without Social Media | Viral loops that work without external social networks |
| J | X | Anti-Cringe Safeguards | Prevent cringe-worthy sharing moments |
| J | XI | Data-Driven Viral Optimization | Optimize viral features based on data |
| J | XII | Alien-Level But Real | Advanced viral features that feel natural |
| J | XIII | Final Edge | Edge features that maximize virality |

---

### K) ADMIN GOD-MODE

| Section | Item | Enhancement Name | Intent (1-sentence) |
|---------|------|------------------|---------------------|
| K | I | Core Philosophy | Admin tools that feel powerful but safe |
| K | II | Admin Home = Control Tower | Central admin dashboard with all critical info |
| K | III | User God-Mode | Total visibility into all users and their data |
| K | IV | Role & Permission Absolute Control | Complete control over user roles and permissions |
| K | V | Coach Governance | Approve, manage, and monitor coaches |
| K | VI | Client Safety & Trust | Tools to ensure client safety and build trust |
| K | VII | Support System | Enterprise-grade support ticket system |
| K | VIII | Incident & Crisis Management | Manage incidents and crises effectively |
| K | IX | Feature Flags & Live Control | Control features in real-time with feature flags |
| K | X | AI & Cost Governance | Monitor and control AI usage and costs |
| K | XI | Data, Exports & Compliance | Export data and ensure compliance |
| K | XII | Analytics & Business Intelligence | Business analytics and intelligence |
| K | XIII | System Health & Reliability | Monitor system health and reliability |
| K | XIV | Meta-Admin | Admin system for managing admins |
| K | XV | Extreme / God-Tier Features | Advanced admin features that feel powerful |
| K | XVI | Final Safety Layer | Safety features that prevent catastrophic errors |

---

## B) CODEBASE REALITY CHECK (âœ…/ðŸŸ¡/âŒ)

### A) LIVING COACH SYSTEMS

| Item | Status | Evidence |
|------|--------|----------|
| **A.I - Coach Daily Dominance** | ðŸŸ¡ | **File:** `lib/screens/dashboard/modern_coach_dashboard.dart` (exists) **Missing:** Dominance features, critical actions at a glance **Table:** `coach_dashboard_stats` (not found) |
| **A.II - Client Intelligence** | âœ… | **File:** `lib/services/coach/coach_analytics_service.dart` **Class:** `CoachAnalyticsService` **Table:** `progress_entries`, `workout_sessions`, `nutrition_items` |
| **A.III - Communication Superpowers** | âœ… | **File:** `lib/services/messaging/ai_draft_reply_service.dart` **Class:** `AIDraftReplyService` **Table:** `messages` (parent_id for threading) |
| **A.IV - Knowledge & Memory** | ðŸŸ¡ | **File:** `lib/services/ai/embedding_helper.dart` **Class:** `EmbeddingHelper` **Table:** `note_embeddings` (pgvector) **Missing:** Contextual memory surfacing, knowledgeâ†’action |
| **A.V - Workout Control & Adaptation** | âœ… | **File:** `lib/screens/workout/revolutionary_plan_builder_screen.dart` **Class:** `RevolutionaryPlanBuilderScreen` **Table:** `workout_plans`, `workout_weeks` |
| **A.VI - Nutrition Control Without Micromanaging** | âœ… | **File:** `lib/screens/nutrition/nutrition_plan_builder.dart` **Class:** `NutritionPlanBuilder` **Table:** `nutrition_plans` |
| **A.VII - Session & Calendar Mastery** | ðŸŸ¡ | **File:** `lib/services/calendar/event_service.dart` **Table:** `calendar_events` **Missing:** Full session-calendar integration |
| **A.VIII - Multi-Client Management** | âœ… | **File:** `lib/screens/coach/modern_client_management_screen.dart` **Class:** `ModernClientManagementScreen` **Table:** `coach_clients` |
| **A.IX - Coach Performance & Self-Care** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **A.X - Authority, Status & Trust** | ðŸŸ¡ | **File:** `lib/screens/coach_profile/` (exists) **Table:** `coach_profiles` **Missing:** Full authority system, trust indicators |
| **A.XI - Stealth Power Features** | âŒ | **File:** **MISSING** **Table:** **MISSING** |

---

### B) BEHAVIOR & RETENTION WEAPONS

| Item | Status | Evidence |
|------|--------|----------|
| **B.I - Daily Open! Immediate Dopamine** | ðŸŸ¡ | **File:** `lib/screens/dashboard/modern_client_dashboard.dart` (exists) **Missing:** Dopamine optimization, first 3 seconds magic **Table:** N/A |
| **B.II - Streaks That Don't Make People Quit** | âœ… | **File:** `lib/services/streaks/streak_service.dart` **Class:** `StreakService` **Table:** `user_streaks`, `streak_days` |
| **B.III - Miss A Day? Prevent The Death Spiral** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **B.IV - Daily Missions = Addiction Engine** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **B.V - XP, Levels & Status** | âœ… | **File:** `lib/screens/rank/rank_screen.dart` **Class:** `RankScreen` **Table:** `user_ranks` |
| **B.VI - Emotional Retention** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **B.VII - Time & Progress Awareness** | ðŸŸ¡ | **File:** `lib/screens/progress/` (exists) **Table:** `progress_entries` **Missing:** Time awareness features |
| **B.VIII - Social Pressure Without Toxicity** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **B.IX - Decision Fatigue Killers** | ðŸŸ¡ | **File:** `lib/services/ai/` (AI suggestions exist) **Missing:** Full decision fatigue reduction system |
| **B.X - Extreme Retention Weapons** | âŒ | **File:** **MISSING** **Table:** **MISSING** |

---

### C) CLIENT MISSION CONTROL DASHBOARD

| Item | Status | Evidence |
|------|--------|----------|
| **C.I - Mission Control Dashboard** | ðŸŸ¡ | **File:** `lib/screens/dashboard/modern_client_dashboard.dart` (exists) **Missing:** Mission control feel, command center UI **Table:** N/A |
| **C.II - Invisible Noticeability** | ðŸŸ¡ | **File:** Various (features exist but not optimized for invisibility) **Missing:** Invisibility optimization |
| **C.III - Alien-Level UX** | âŒ | **File:** **MISSING** **Table:** **MISSING** |

---

### D) WORKOUT SUPERCOMPUTER

| Item | Status | Evidence |
|------|--------|----------|
| **D.I - Workout = System, Not List** | âœ… | **File:** `lib/screens/workout/revolutionary_plan_builder_screen.dart` **Class:** `RevolutionaryPlanBuilderScreen` **Table:** `workout_plans`, `workout_weeks`, `workout_days`, `exercises` |
| **D.II - Set-Level Intelligence** | âœ… | **File:** `lib/models/workout/exercise.dart` **Class:** `Exercise` **Fields:** `rir`, `rpe`, `tempo`, `rest_seconds` **Table:** `exercises` |
| **D.III - Exercise-Level Superpowers** | âœ… | **File:** `lib/services/workout/exercise_library_service.dart` **Class:** `ExerciseLibraryService` **Table:** `exercise_library` |
| **D.IV - Session Transformation Modes** | ðŸŸ¡ | **File:** `lib/screens/workout/client_workout_dashboard_screen.dart` **Table:** `workout_sessions` **Missing:** Transformation modes (strength/hypertrophy/endurance/deload) |
| **D.V - Weekly & Mesocycle Intelligence** | âœ… | **File:** `lib/models/workout/workout_plan.dart` **Class:** `WorkoutPlan` **Table:** `workout_weeks` |
| **D.VI - Progression Engine** | âœ… | **File:** `lib/services/workout/progression_service.dart` **Class:** `ProgressionService` **Table:** N/A (calculated) **Note:** 5 periodization models implemented |
| **D.VII - Fatigue, Recovery & Readiness** | ðŸŸ¡ | **File:** `lib/models/workout/analytics_models.dart` **Class:** `FatigueIndex` (model exists) **Table:** **MISSING** (no `fatigue_logs` table) **Missing:** Service implementation, UI, database table |
| **D.VIII - Technique & Execution** | ðŸŸ¡ | **File:** `lib/models/workout/exercise.dart` **Fields:** `form_quality`, `form_cues` **Table:** `exercises` **Missing:** Video AI, full execution tracking |
| **D.IX - Analytics That Actually Matter** | âœ… | **File:** `lib/services/workout/workout_analytics_service.dart` **Class:** `WorkoutAnalyticsService` **Table:** `exercise_logs`, `workout_sessions` |
| **D.X - Coach Control Layer** | âœ… | **File:** `lib/screens/workout/revolutionary_plan_builder_screen.dart` **Table:** `workout_plans` |
| **D.XI - Client Psychology Inside Workout** | ðŸŸ¡ | **File:** `lib/screens/workout/client_workout_dashboard_screen.dart` **Table:** `workout_sessions` **Missing:** Psychology features, motivation during sessions |
| **D.XII - Extreme / Alien But Still Real** | âŒ | **File:** **MISSING** **Table:** **MISSING** |

---

### E) NUTRITION DOMINATION

| Item | Status | Evidence |
|------|--------|----------|
| **E.I - Nutrition = Control System** | âœ… | **File:** `lib/services/nutrition/nutrition_service.dart` **Class:** `NutritionService` **Table:** `nutrition_plans` |
| **E.II - Macros That Don't Make People Quit** | âœ… | **File:** `lib/widgets/nutrition/macro_rings.dart` **Class:** `MacroRings` **Table:** `nutrition_items` |
| **E.III - Meal Systems That Feel Effortless** | âœ… | **File:** `lib/services/nutrition/meal_prep_service.dart` **Class:** `MealPrepService` **Table:** `meal_prep_plans` |
| **E.IV - Digestion, Bloat & Compliance** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **E.V - Electrolytes & Water** | âœ… | **File:** `lib/services/nutrition/hydration_service.dart` **Class:** `HydrationService` **Table:** `nutrition_hydration_logs` |
| **E.VI - Refeds, Diet Breaks & Adaptation** | ðŸŸ¡ | **File:** `lib/services/nutrition/` **Table:** `refeed_schedules` (exists) **Missing:** UI, full implementation |
| **E.VII - Rest Days, Travel & Chaos Control** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **E.VIII - Psychology & Adherence** | ðŸŸ¡ | **File:** `lib/services/streaks/streak_service.dart` **Table:** `user_streaks` **Missing:** Full psychology system |
| **E.IX - Coach Control Without Micromanagement** | âœ… | **File:** `lib/screens/nutrition/nutrition_plan_builder.dart` **Table:** `nutrition_plans` |
| **E.X - Analytics That Actually Matter** | âœ… | **File:** `lib/services/nutrition/analytics_engine_service.dart` **Class:** `AnalyticsEngineService` **Table:** `nutrition_items` |
| **E.XI - Extreme / Alien But Real** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **E.XII - Final Insane Layer** | âŒ | **File:** **MISSING** **Table:** **MISSING** |

---

### F) MESSAGING WEAPON

| Item | Status | Evidence |
|------|--------|----------|
| **F.I - Real-time Messaging** | âœ… | **File:** `lib/screens/messaging/modern_messenger_screen.dart` **Class:** `ModernMessengerScreen` **Table:** `messages` |
| **F.II - Message Threading** | âœ… | **File:** `lib/services/messages_service.dart` **Class:** `MessagesService` **Table:** `messages` (parent_id column) |
| **F.III - AI Smart Replies** | âœ… | **File:** `lib/services/ai/messaging_ai.dart` **Class:** `MessagingAI` **Table:** N/A |
| **F.IV - Message Pinning** | âœ… | **File:** `lib/services/messages_service.dart` **Table:** `messages` (is_pinned column) |
| **F.V - Message Search** | âœ… | **File:** `lib/services/messages_service.dart` **Table:** `message_embeddings` (semantic search) |
| **F.VI - Translation Support** | âœ… | **File:** `lib/widgets/messaging/translation_toggle.dart` **Table:** N/A |
| **F.VII - Quick Actions** | âœ… | **File:** `lib/services/calendar/quickbook_reschedule_service.dart` **Table:** `booking_requests` |
| **F.VIII - Message Attachments** | âœ… | **File:** `lib/services/messages_service.dart` **Table:** `messages` (attachments column) |
| **F.IX - Message Reactions** | ðŸŸ¡ | **File:** `lib/services/messages_service.dart` **Table:** `messages` (reactions column may exist) **Missing:** UI for reactions |
| **F.X - Message Threading UI** | âœ… | **File:** `lib/screens/messaging/client_threads_screen.dart` **Table:** `message_threads` |

---

### G) NOTES + EMBEDDINGS SECOND BRAIN

| Item | Status | Evidence |
|------|--------|----------|
| **G.I - Core Idea** | âœ… | **File:** `lib/services/ai/embedding_helper.dart` **Class:** `EmbeddingHelper` **Table:** `note_embeddings` (pgvector) |
| **G.II - Knowledge Ingestion** | ðŸŸ¡ | **File:** `lib/services/admin/admin_knowledge_service.dart` **Table:** N/A **Missing:** Full ingestion system |
| **G.III - Semantic Search** | âœ… | **File:** `lib/services/ai/embedding_helper.dart` **Table:** `note_embeddings`, `message_embeddings` (pgvector cosine similarity) |
| **G.IV - Contextual Memory Surfacing** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **G.V - Knowledge Structuring** | ðŸŸ¡ | **File:** `lib/services/ai/embedding_helper.dart` **Table:** `note_embeddings` **Missing:** Full structuring system |
| **G.VI - Knowledge â†’ Action** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **G.VII - Coach Second Brain UI** | ðŸŸ¡ | **File:** `lib/screens/notes/coach_note_screen.dart` **Table:** `coach_notes` **Missing:** Full "second brain" UI |
| **G.VIII - Client-Facing Knowledge** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **G.IX - Embeddings as Compression** | âœ… | **File:** `lib/services/ai/embedding_helper.dart` **Table:** pgvector tables |
| **G.X - Coach Learning & Self-Improvement** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **G.XI - Admin / System Intelligence** | âœ… | **File:** `lib/screens/admin/` (35 screens) **Table:** Various admin tables |
| **G.XII - Alien-Level But Still Real** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **G.XIII - Final Edge** | âŒ | **File:** **MISSING** **Table:** **MISSING** |

---

### H) CALENDAR PREMIUM SCHEDULING

| Item | Status | Evidence |
|------|--------|----------|
| **H.I - Calendar Views** | âœ… | **File:** `lib/screens/calendar/calendar_screen.dart` **Class:** `CalendarScreen` **Table:** `calendar_events` |
| **H.II - Event CRUD** | âœ… | **File:** `lib/services/calendar/event_service.dart` **Class:** `EventService` **Table:** `calendar_events` |
| **H.III - Recurring Events** | âœ… | **File:** `lib/services/calendar/recurring_event_handler.dart` **Class:** `RecurringEventHandler` **Table:** `calendar_events` (rrule column) |
| **H.IV - Booking System** | ðŸŸ¡ | **File:** `lib/services/calendar/booking_conflict_service.dart` **Table:** `booking_requests` **Missing:** Full UI implementation |
| **H.V - Reminders** | âœ… | **File:** `lib/services/calendar/reminder_manager.dart` **Class:** `ReminderManager` **Table:** N/A (local notifications) |
| **H.VI - Event Tags** | âœ… | **File:** `lib/services/calendar/smart_event_tagger.dart` **Table:** `calendar_events` (tags column) |
| **H.VII - File Attachments** | âœ… | **File:** `lib/components/calendar/attached_file_preview.dart` **Table:** `calendar_events` (attachments column) |
| **H.VIII - AI Event Tagging** | âœ… | **File:** `lib/services/ai/calendar_ai.dart` **Class:** `CalendarAI` **Table:** N/A |
| **H.IX - Conflict Detection** | âœ… | **File:** Edge function **Table:** `calendar_events` |
| **H.X - Session & Calendar Mastery** | ðŸŸ¡ | **File:** `lib/services/calendar/` **Table:** `calendar_events` **Missing:** Full session-calendar integration |

---

### I) PROGRESS & ANALYTICS DOPAMINE

| Item | Status | Evidence |
|------|--------|----------|
| **I.I - Progress Charts** | âœ… | **File:** `lib/screens/progress/` **Table:** `progress_entries` |
| **I.II - Compliance Tracking** | âœ… | **File:** `lib/services/progress/progress_service.dart` **Table:** `progress_entries` |
| **I.III - Check-in Calendar** | âœ… | **File:** `lib/screens/checkins/checkin_history_screen.dart` **Table:** `checkins` |
| **I.IV - Coach Feedback** | âœ… | **File:** `lib/services/progress/progress_service.dart` **Table:** `progress_entries` (coach_feedback column) |
| **I.V - Progress Analytics** | âœ… | **File:** `lib/services/progress/progress_service.dart` **Table:** `progress_entries` |
| **I.VI - Progress Export** | âœ… | **File:** `lib/screens/progress/export_progress_screen.dart` **Table:** `progress_entries` |

---

### J) VIRAL & SHARE LOOPS

| Item | Status | Evidence |
|------|--------|----------|
| **J.I - Core Principle** | âœ… | **File:** `lib/services/growth/referrals_service.dart` **Table:** `referral_codes`, `referrals` |
| **J.II - Passive Virality** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **J.III - Social Proof Without Comparison** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **J.IV - Referrals That Don't Feel Like Referrals** | âœ… | **File:** `lib/services/growth/referrals_service.dart` **Class:** `ReferralsService` **Table:** `referral_codes`, `referrals` |
| **J.V - Share Inside Private Spaces** | âœ… | **File:** `lib/services/share/share_card_service.dart` **Class:** `ShareCardService` **Table:** N/A |
| **J.VI - Virality Through Coaches** | âœ… | **File:** `lib/widgets/coaches/coach_share_qr_sheet.dart` **Table:** `coach_qr_tokens` |
| **J.VII - Scarcity & Exclusivity** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **J.VIII - Shareable Identity** | ðŸŸ¡ | **File:** `lib/services/share/share_card_service.dart` **Table:** N/A **Missing:** Full identity sharing |
| **J.IX - Viral Loops Without Social Media** | âœ… | **File:** `lib/services/growth/referrals_service.dart` **Table:** `referrals` |
| **J.X - Anti-Cringe Safeguards** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **J.XI - Data-Driven Viral Optimization** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **J.XII - Alien-Level But Real** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **J.XIII - Final Edge** | âŒ | **File:** **MISSING** **Table:** **MISSING** |

---

### K) ADMIN GOD-MODE

| Item | Status | Evidence |
|------|--------|----------|
| **K.I - Core Philosophy** | âœ… | **File:** `lib/screens/admin/admin_hub_screen.dart` **Table:** N/A |
| **K.II - Admin Home = Control Tower** | âœ… | **File:** `lib/screens/admin/admin_hub_screen.dart` **Class:** `AdminHubScreen` **Table:** N/A |
| **K.III - User God-Mode** | âœ… | **File:** `lib/screens/admin/user_manager_panel.dart` **Class:** `UserManagerPanel` **Table:** `profiles` |
| **K.IV - Role & Permission Absolute Control** | âœ… | **File:** `lib/screens/admin/admin_screen.dart` **Table:** `profiles` (role column) |
| **K.V - Coach Governance** | âœ… | **File:** `lib/screens/admin/coach_approval_panel.dart` **Table:** `coach_applications` |
| **K.VI - Client Safety & Trust** | âœ… | **File:** `lib/screens/admin/` (multiple screens) **Table:** Various |
| **K.VII - Support System** | âœ… | **File:** `lib/screens/admin/support_inbox_screen.dart` **Table:** `support_requests` |
| **K.VIII - Incident & Crisis Management** | âœ… | **File:** `lib/screens/admin/admin_incidents_screen.dart` **Table:** `incidents` |
| **K.IX - Feature Flags & Live Control** | âœ… | **File:** `lib/services/config/feature_flags.dart` **Class:** `FeatureFlags` **Table:** `user_feature_flags` |
| **K.X - AI & Cost Governance** | âœ… | **File:** `lib/screens/admin/ai_config_panel.dart` **Table:** `ai_usage` |
| **K.XI - Data, Exports & Compliance** | ðŸŸ¡ | **File:** `lib/screens/progress/export_progress_screen.dart` **Table:** Various **Missing:** Full compliance system |
| **K.XII - Analytics & Business Intelligence** | âœ… | **File:** `lib/screens/admin/admin_analytics_screen.dart` **Table:** Various |
| **K.XIII - System Health & Reliability** | âœ… | **File:** `lib/widgets/admin/system_health_panel.dart` **Table:** N/A |
| **K.XIV - Meta-Admin** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **K.XV - Extreme / God-Tier Features** | âŒ | **File:** **MISSING** **Table:** **MISSING** |
| **K.XVI - Final Safety Layer** | ðŸŸ¡ | **File:** `lib/screens/admin/audit_log_screen.dart` **Table:** `admin_audit_log` **Missing:** Full safety layer system |

---

## C) GAP CLUSTERS (THE ONLY ONES WE IMPLEMENT FIRST)

### CLUSTER 1: WORKOUT â€” Fatigue/Readiness + Session Modes + Psychology

**Gap Items:**
- D.VII - Fatigue, Recovery & Readiness (ðŸŸ¡ - model exists, service/UI missing)
- D.IV - Session Transformation Modes (ðŸŸ¡ - session tracking exists, modes missing)
- D.XI - Client Psychology Inside Workout (ðŸŸ¡ - session tracking exists, psychology missing)

**Risk Level:** LOW (new features, no existing logic to break)

**Dependencies:**
- Existing: `workout_sessions` table, `Exercise` model with RPE/RIR
- New: `fatigue_logs` table, `recovery_scores` table

---

### CLUSTER 2: NUTRITION â€” Digestion/Bloat + Electrolytes + Travel/Chaos Control

**Gap Items:**
- E.IV - Digestion, Bloat & Compliance (âŒ - completely missing)
- E.VII - Rest Days, Travel & Chaos Control (âŒ - completely missing)
- E.VIII - Psychology & Adherence (ðŸŸ¡ - streaks exist, full psychology missing)

**Risk Level:** LOW (new features, no existing logic to break)

**Dependencies:**
- Existing: `nutrition_plans`, `nutrition_items`, `user_streaks`
- New: `digestion_logs` table, `travel_modes` table, `chaos_control_settings` table

---

### CLUSTER 3: SECOND BRAIN â€” Contextual Memory + Knowledgeâ†’Action

**Gap Items:**
- G.IV - Contextual Memory Surfacing (âŒ - completely missing)
- G.VI - Knowledge â†’ Action (âŒ - completely missing)
- G.VII - Coach Second Brain UI (ðŸŸ¡ - notes exist, full UI missing)

**Risk Level:** LOW (new features, extends existing embeddings)

**Dependencies:**
- Existing: `note_embeddings`, `message_embeddings`, `coach_notes`
- New: `contextual_memory_cache` table, `knowledge_actions` table

---

### CLUSTER 4: RETENTION â€” Daily Missions + Death Spiral Prevention + Dopamine Open

**Gap Items:**
- B.IV - Daily Missions = Addiction Engine (âŒ - completely missing)
- B.III - Miss A Day? Prevent The Death Spiral (âŒ - completely missing)
- B.I - Daily Open! Immediate Dopamine (ðŸŸ¡ - dashboard exists, dopamine optimization missing)

**Risk Level:** LOW (new features, minimal patches to dashboard)

**Dependencies:**
- Existing: `user_streaks`, `modern_client_dashboard.dart`
- New: `daily_missions` table, `death_spiral_prevention_logs` table

---

### CLUSTER 5: ADMIN â€” Meta-Admin + Compliance/Export + Safety Layer

**Gap Items:**
- K.XIV - Meta-Admin (âŒ - completely missing)
- K.XI - Data, Exports & Compliance (ðŸŸ¡ - export exists, full compliance missing)
- K.XVI - Final Safety Layer (ðŸŸ¡ - audit logs exist, full safety layer missing)

**Risk Level:** LOW (new features, extends existing admin system)

**Dependencies:**
- Existing: `admin_audit_log`, `admin_hub_screen.dart`
- New: `admin_hierarchy` table, `compliance_reports` table, `safety_layer_rules` table

---

### CLUSTER 6: VIRAL â€” Passive Virality + Anti-Cringe Safeguards + Viral Analytics

**Gap Items:**
- J.II - Passive Virality (âŒ - completely missing)
- J.X - Anti-Cringe Safeguards (âŒ - completely missing)
- J.XI - Data-Driven Viral Optimization (âŒ - completely missing)

**Risk Level:** LOW (new features, no existing logic to break)

**Dependencies:**
- Existing: `referral_codes`, `referrals`, `share_card_service.dart`
- New: `viral_events` table, `anti_cringe_rules` table, `viral_analytics` table

---

## D) SAFE IMPLEMENTATION PLAN (ADD-ONLY)

### CLUSTER 1: WORKOUT â€” Fatigue/Readiness + Session Modes + Psychology

#### New DB Migration(s)

**File:** `supabase/migrations/YYYYMMDDHHMMSS_workout_fatigue_recovery.sql`

**Tables/Columns:**
```sql
-- Fatigue tracking
CREATE TABLE fatigue_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  workout_session_id UUID REFERENCES workout_sessions(id),
  fatigue_score INTEGER CHECK (fatigue_score >= 0 AND fatigue_score <= 10),
  recovery_score INTEGER CHECK (recovery_score >= 0 AND recovery_score <= 10),
  readiness_score INTEGER CHECK (readiness_score >= 0 AND readiness_score <= 10),
  sleep_quality INTEGER CHECK (sleep_quality >= 0 AND sleep_quality <= 10),
  stress_level INTEGER CHECK (stress_level >= 0 AND stress_level <= 10),
  energy_level INTEGER CHECK (energy_level >= 0 AND energy_level <= 10),
  notes TEXT,
  logged_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Recovery scores (aggregated)
CREATE TABLE recovery_scores (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  date DATE NOT NULL,
  overall_recovery DECIMAL(3,1) CHECK (overall_recovery >= 0 AND overall_recovery <= 10),
  calculated_from_fatigue_logs BOOLEAN DEFAULT false,
  recommendation TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(user_id, date)
);

-- Session transformation modes
ALTER TABLE workout_sessions ADD COLUMN IF NOT EXISTS transformation_mode TEXT CHECK (transformation_mode IN ('strength', 'hypertrophy', 'endurance', 'deload', 'power', 'default'));

-- RLS Policies
ALTER TABLE fatigue_logs ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own fatigue logs" ON fatigue_logs FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own fatigue logs" ON fatigue_logs FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Coaches can view client fatigue logs" ON fatigue_logs FOR SELECT USING (
  EXISTS (SELECT 1 FROM coach_clients WHERE coach_id = auth.uid() AND client_id = fatigue_logs.user_id)
);

ALTER TABLE recovery_scores ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own recovery scores" ON recovery_scores FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Coaches can view client recovery scores" ON recovery_scores FOR SELECT USING (
  EXISTS (SELECT 1 FROM coach_clients WHERE coach_id = auth.uid() AND client_id = recovery_scores.user_id)
);
```

#### New Dart Files to Create

1. **`lib/services/workout/fatigue_recovery_service.dart`**
   - Class: `FatigueRecoveryService` (singleton)
   - Methods: `logFatigue()`, `getRecoveryScore()`, `getReadinessScore()`, `calculateRecoveryFromLogs()`

2. **`lib/models/workout/fatigue_models.dart`**
   - Classes: `FatigueLog`, `RecoveryScore`, `ReadinessIndicator`
   - Enums: `TransformationMode` (strength, hypertrophy, endurance, deload, power, default)

3. **`lib/screens/workout/fatigue_recovery_screen.dart`**
   - Screen: `FatigueRecoveryScreen`
   - Features: Log fatigue, view recovery scores, readiness indicators

4. **`lib/services/workout/psychology_service.dart`**
   - Class: `WorkoutPsychologyService` (singleton)
   - Methods: `getMotivationalMessage()`, `trackSessionPsychology()`, `getEncouragement()`

5. **`lib/widgets/workout/session_mode_selector.dart`**
   - Widget: `SessionModeSelector`
   - Features: Select transformation mode before/during session

#### Existing Files to Patch

1. **`lib/screens/workout/client_workout_dashboard_screen.dart`**
   - **Insertion Location:** After line 100 (after plan display)
   - **Marker Start:** `// âœ… VAGUS ADD: session-transformation-modes START`
   - **Marker End:** `// âœ… VAGUS ADD: session-transformation-modes END`
   - **Patch:** Add session mode selector widget

2. **`lib/screens/workout/client_workout_dashboard_screen.dart`**
   - **Insertion Location:** After session mode selector
   - **Marker Start:** `// âœ… VAGUS ADD: fatigue-recovery-readiness START`
   - **Marker End:** `// âœ… VAGUS ADD: fatigue-recovery-readiness END`
   - **Patch:** Add fatigue/recovery/readiness display widget

3. **`lib/screens/workout/client_workout_dashboard_screen.dart`**
   - **Insertion Location:** After recovery display
   - **Marker Start:** `// âœ… VAGUS ADD: client-psychology START`
   - **Marker End:** `// âœ… VAGUS ADD: client-psychology END`
   - **Patch:** Add psychology features (motivation, encouragement)

4. **`lib/services/workout/workout_service.dart`**
   - **Insertion Location:** After session creation method
   - **Marker Start:** `// âœ… VAGUS ADD: transformation-mode-support START`
   - **Marker End:** `// âœ… VAGUS ADD: transformation-mode-support END`
   - **Patch:** Add transformation mode handling

#### Feature Flags to Add

**File:** `lib/services/config/feature_flags.dart`

**Add to class constants:**
```dart
// Workout Enhancements
static const String workoutFatigueTracking = 'workout_fatigue_tracking';
static const String workoutRecoveryScores = 'workout_recovery_scores';
static const String workoutReadinessIndicators = 'workout_readiness_indicators';
static const String workoutTransformationModes = 'workout_transformation_modes';
static const String workoutPsychology = 'workout_psychology';
```

**Add to `_getDefaultFlags()` method:**
```dart
// Workout Enhancements (default OFF)
workoutFatigueTracking: false,
workoutRecoveryScores: false,
workoutReadinessIndicators: false,
workoutTransformationModes: false,
workoutPsychology: false,
```

#### Minimal Test Checklist

- [ ] Fatigue log saves to `fatigue_logs` table
- [ ] Recovery score calculates correctly from fatigue logs
- [ ] Readiness indicator displays based on recovery score
- [ ] Session transformation mode saves to `workout_sessions.transformation_mode`
- [ ] Transformation mode affects workout display/logic
- [ ] Psychology service provides motivational messages
- [ ] Psychology features integrate with session tracking
- [ ] RLS policies prevent unauthorized access
- [ ] No regressions in existing workout features
- [ ] Feature flags disable features when OFF

---

### CLUSTER 2: NUTRITION â€” Digestion/Bloat + Electrolytes + Travel/Chaos Control

#### New DB Migration(s)

**File:** `supabase/migrations/YYYYMMDDHHMMSS_nutrition_digestion_chaos_control.sql`

**Tables/Columns:**
```sql
-- Digestion tracking
CREATE TABLE digestion_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  date DATE NOT NULL,
  digestion_quality INTEGER CHECK (digestion_quality >= 1 AND digestion_quality <= 5),
  bloat_level INTEGER CHECK (bloat_level >= 0 AND bloat_level <= 10),
  bloating_factors TEXT[], -- Array of factors (e.g., ['dairy', 'gluten', 'high_fiber'])
  compliance_score INTEGER CHECK (compliance_score >= 0 AND compliance_score <= 100),
  notes TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(user_id, date)
);

-- Travel/chaos control
CREATE TABLE travel_modes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  start_date DATE NOT NULL,
  end_date DATE,
  mode TEXT NOT NULL CHECK (mode IN ('travel', 'chaos', 'rest_day', 'normal')),
  location TEXT,
  nutrition_plan_id UUID REFERENCES nutrition_plans(id),
  adapted_macros JSONB, -- Override macros for travel/chaos
  notes TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Chaos control settings
CREATE TABLE chaos_control_settings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  auto_adapt_on_chaos BOOLEAN DEFAULT true,
  chaos_detection_enabled BOOLEAN DEFAULT true,
  travel_mode_auto_enable BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(user_id)
);

-- RLS Policies
ALTER TABLE digestion_logs ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own digestion logs" ON digestion_logs FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own digestion logs" ON digestion_logs FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Coaches can view client digestion logs" ON digestion_logs FOR SELECT USING (
  EXISTS (SELECT 1 FROM coach_clients WHERE coach_id = auth.uid() AND client_id = digestion_logs.user_id)
);

ALTER TABLE travel_modes ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own travel modes" ON travel_modes FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own travel modes" ON travel_modes FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Coaches can view client travel modes" ON travel_modes FOR SELECT USING (
  EXISTS (SELECT 1 FROM coach_clients WHERE coach_id = auth.uid() AND client_id = travel_modes.user_id)
);

ALTER TABLE chaos_control_settings ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own chaos settings" ON chaos_control_settings FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can update own chaos settings" ON chaos_control_settings FOR UPDATE USING (auth.uid() = user_id);
```

#### New Dart Files to Create

1. **`lib/services/nutrition/digestion_tracking_service.dart`**
   - Class: `DigestionTrackingService` (singleton)
   - Methods: `logDigestion()`, `getDigestionHistory()`, `getBloatTrends()`, `getComplianceScore()`

2. **`lib/models/nutrition/digestion_models.dart`**
   - Classes: `DigestionLog`, `BloatFactors`, `ComplianceScore`

3. **`lib/screens/nutrition/digestion_tracking_screen.dart`**
   - Screen: `DigestionTrackingScreen`
   - Features: Log digestion, view trends, bloat tracking

4. **`lib/services/nutrition/chaos_control_service.dart`**
   - Class: `ChaosControlService` (singleton)
   - Methods: `enableTravelMode()`, `detectChaos()`, `adaptNutritionPlan()`, `getChaosSettings()`

5. **`lib/services/nutrition/adherence_psychology_service.dart`**
   - Class: `AdherencePsychologyService` (singleton)
   - Methods: `getAdherenceScore()`, `getPsychologyInsights()`, `getMotivationalMessage()`

#### Existing Files to Patch

1. **`lib/screens/nutrition/nutrition_hub_screen.dart`**
   - **Insertion Location:** After meal display section
   - **Marker Start:** `// âœ… VAGUS ADD: digestion-tracking START`
   - **Marker End:** `// âœ… VAGUS ADD: digestion-tracking END`
   - **Patch:** Add digestion tracking widget/button

2. **`lib/screens/nutrition/nutrition_hub_screen.dart`**
   - **Insertion Location:** After digestion tracking
   - **Marker Start:** `// âœ… VAGUS ADD: chaos-control START`
   - **Marker End:** `// âœ… VAGUS ADD: chaos-control END`
   - **Patch:** Add travel mode/chaos control widget

3. **`lib/services/streaks/streak_service.dart`**
   - **Insertion Location:** After streak calculation
   - **Marker Start:** `// âœ… VAGUS ADD: nutrition-psychology START`
   - **Marker End:** `// âœ… VAGUS ADD: nutrition-psychology END`
   - **Patch:** Integrate with adherence psychology service

#### Feature Flags to Add

**File:** `lib/services/config/feature_flags.dart`

**Add to class constants:**
```dart
// Nutrition Enhancements
static const String nutritionDigestionTracking = 'nutrition_digestion_tracking';
static const String nutritionBloatTracking = 'nutrition_bloat_tracking';
static const String nutritionChaosControl = 'nutrition_chaos_control';
static const String nutritionTravelMode = 'nutrition_travel_mode';
static const String nutritionPsychology = 'nutrition_psychology';
```

**Add to `_getDefaultFlags()` method:**
```dart
// Nutrition Enhancements (default OFF)
nutritionDigestionTracking: false,
nutritionBloatTracking: false,
nutritionChaosControl: false,
nutritionTravelMode: false,
nutritionPsychology: false,
```

#### Minimal Test Checklist

- [ ] Digestion log saves to `digestion_logs` table
- [ ] Bloat tracking works correctly
- [ ] Travel mode activates and adapts nutrition plan
- [ ] Chaos control detects schedule changes
- [ ] Chaos control adapts macros automatically
- [ ] Psychology service provides adherence insights
- [ ] Psychology features integrate with nutrition tracking
- [ ] RLS policies prevent unauthorized access
- [ ] No regressions in existing nutrition features
- [ ] Feature flags disable features when OFF

---

### CLUSTER 3: SECOND BRAIN â€” Contextual Memory + Knowledgeâ†’Action

#### New DB Migration(s)

**File:** `supabase/migrations/YYYYMMDDHHMMSS_knowledge_brain_enhancements.sql`

**Tables/Columns:**
```sql
-- Contextual memory cache
CREATE TABLE contextual_memory_cache (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  context_key TEXT NOT NULL, -- e.g., 'workout_session_123', 'client_conversation_456'
  relevant_note_ids UUID[] NOT NULL, -- Array of note IDs
  relevance_scores DECIMAL[] NOT NULL, -- Array of similarity scores
  cached_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  expires_at TIMESTAMPTZ NOT NULL,
  UNIQUE(user_id, context_key)
);

-- Knowledge actions
CREATE TABLE knowledge_actions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  source_note_id UUID REFERENCES coach_notes(id),
  action_type TEXT NOT NULL CHECK (action_type IN ('reminder', 'task', 'follow_up', 'alert')),
  action_data JSONB NOT NULL,
  triggered_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Shared knowledge (client-facing)
CREATE TABLE shared_knowledge (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  coach_id UUID NOT NULL REFERENCES profiles(id),
  client_id UUID NOT NULL REFERENCES profiles(id),
  source_note_id UUID REFERENCES coach_notes(id),
  shared_content TEXT NOT NULL,
  shared_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  viewed_at TIMESTAMPTZ,
  UNIQUE(coach_id, client_id, source_note_id)
);

-- RLS Policies
ALTER TABLE contextual_memory_cache ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own memory cache" ON contextual_memory_cache FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own memory cache" ON contextual_memory_cache FOR INSERT WITH CHECK (auth.uid() = user_id);

ALTER TABLE knowledge_actions ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own knowledge actions" ON knowledge_actions FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own knowledge actions" ON knowledge_actions FOR INSERT WITH CHECK (auth.uid() = user_id);

ALTER TABLE shared_knowledge ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Coaches can view own shared knowledge" ON shared_knowledge FOR SELECT USING (auth.uid() = coach_id);
CREATE POLICY "Clients can view shared knowledge" ON shared_knowledge FOR SELECT USING (auth.uid() = client_id);
CREATE POLICY "Coaches can share knowledge" ON shared_knowledge FOR INSERT WITH CHECK (auth.uid() = coach_id);
```

#### New Dart Files to Create

1. **`lib/services/ai/contextual_memory_service.dart`**
   - Class: `ContextualMemoryService` (singleton)
   - Methods: `surfaceRelevantNotes()`, `cacheContextualMemory()`, `getCachedMemory()`

2. **`lib/services/ai/knowledge_action_service.dart`**
   - Class: `KnowledgeActionService` (singleton)
   - Methods: `extractActionsFromNote()`, `createAction()`, `triggerAction()`, `completeAction()`

3. **`lib/screens/notes/knowledge_actions_panel.dart`**
   - Widget: `KnowledgeActionsPanel`
   - Features: Display actions extracted from notes, trigger actions

4. **`lib/services/coach/knowledge_sharing_service.dart`**
   - Class: `KnowledgeSharingService` (singleton)
   - Methods: `shareKnowledgeWithClient()`, `getSharedKnowledge()`, `revokeSharedKnowledge()`

5. **`lib/screens/coach/knowledge_sharing_screen.dart`**
   - Screen: `KnowledgeSharingScreen`
   - Features: Share controlled knowledge with clients

#### Existing Files to Patch

1. **`lib/screens/notes/coach_note_screen.dart`**
   - **Insertion Location:** After note content section
   - **Marker Start:** `// âœ… VAGUS ADD: contextual-memory START`
   - **Marker End:** `// âœ… VAGUS ADD: contextual-memory END`
   - **Patch:** Add contextual memory surfacing widget

2. **`lib/screens/notes/coach_note_screen.dart`**
   - **Insertion Location:** After contextual memory
   - **Marker Start:** `// âœ… VAGUS ADD: knowledge-actions START`
   - **Marker End:** `// âœ… VAGUS ADD: knowledge-actions END`
   - **Patch:** Add knowledge actions panel

#### Feature Flags to Add

**File:** `lib/services/config/feature_flags.dart`

**Add to class constants:**
```dart
// Knowledge Brain Enhancements
static const String knowledgeContextualMemory = 'knowledge_contextual_memory';
static const String knowledgeActionAutomation = 'knowledge_action_automation';
static const String knowledgeSharing = 'knowledge_sharing';
```

**Add to `_getDefaultFlags()` method:**
```dart
// Knowledge Brain Enhancements (default OFF)
knowledgeContextualMemory: false,
knowledgeActionAutomation: false,
knowledgeSharing: false,
```

#### Minimal Test Checklist

- [ ] Contextual memory surfaces relevant notes based on context
- [ ] Contextual memory cache saves and expires correctly
- [ ] Knowledge actions extract from notes correctly
- [ ] Knowledge actions trigger at specified times
- [ ] Client-facing knowledge sharing works
- [ ] Clients can view shared knowledge
- [ ] Coaches can revoke shared knowledge
- [ ] RLS policies prevent unauthorized access
- [ ] No regressions in existing notes/messaging
- [ ] Feature flags disable features when OFF

---

### CLUSTER 4: RETENTION â€” Daily Missions + Death Spiral Prevention + Dopamine Open

#### New DB Migration(s)

**File:** `supabase/migrations/YYYYMMDDHHMMSS_retention_enhancements.sql`

**Tables/Columns:**
```sql
-- Daily missions
CREATE TABLE daily_missions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  date DATE NOT NULL,
  mission_type TEXT NOT NULL CHECK (mission_type IN ('workout', 'nutrition', 'checkin', 'message', 'custom')),
  mission_title TEXT NOT NULL,
  mission_description TEXT,
  mission_data JSONB, -- Mission-specific data
  completed BOOLEAN DEFAULT false,
  completed_at TIMESTAMPTZ,
  xp_reward INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(user_id, date, mission_type)
);

-- Death spiral prevention
CREATE TABLE death_spiral_prevention_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  missed_date DATE NOT NULL,
  prevention_action TEXT NOT NULL CHECK (prevention_action IN ('reminder', 'encouragement', 'streak_protection', 'mission_adjustment')),
  action_data JSONB,
  action_taken_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  success BOOLEAN, -- Whether prevention worked
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Dopamine open tracking
CREATE TABLE dopamine_open_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  opened_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  dopamine_trigger TEXT, -- What triggered dopamine (e.g., 'streak', 'pr', 'message', 'mission_complete')
  trigger_data JSONB,
  engagement_duration_seconds INTEGER
);

-- RLS Policies
ALTER TABLE daily_missions ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own daily missions" ON daily_missions FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own daily missions" ON daily_missions FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can update own daily missions" ON daily_missions FOR UPDATE USING (auth.uid() = user_id);

ALTER TABLE death_spiral_prevention_logs ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own prevention logs" ON death_spiral_prevention_logs FOR SELECT USING (auth.uid() = user_id);

ALTER TABLE dopamine_open_events ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own dopamine events" ON dopamine_open_events FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "System can insert dopamine events" ON dopamine_open_events FOR INSERT WITH CHECK (true); -- System inserts
```

#### New Dart Files to Create

1. **`lib/services/retention/daily_missions_service.dart`**
   - Class: `DailyMissionsService` (singleton)
   - Methods: `generateDailyMissions()`, `completeMission()`, `getTodayMissions()`, `getMissionHistory()`

2. **`lib/models/retention/mission_models.dart`**
   - Classes: `DailyMission`, `MissionType`, `MissionReward`

3. **`lib/screens/retention/daily_missions_screen.dart`**
   - Screen: `DailyMissionsScreen`
   - Features: Display daily missions, complete missions, view rewards

4. **`lib/services/retention/death_spiral_prevention_service.dart`**
   - Class: `DeathSpiralPreventionService` (singleton)
   - Methods: `detectMissedDay()`, `preventDeathSpiral()`, `getPreventionActions()`, `logPreventionAction()`

5. **`lib/services/retention/dopamine_service.dart`**
   - Class: `DopamineService` (singleton)
   - Methods: `triggerDopamineOnOpen()`, `getDopamineTriggers()`, `logDopamineEvent()`

#### Existing Files to Patch

1. **`lib/screens/dashboard/modern_client_dashboard.dart`**
   - **Insertion Location:** At top of build method (first widget)
   - **Marker Start:** `// âœ… VAGUS ADD: daily-dopamine START`
   - **Marker End:** `// âœ… VAGUS ADD: daily-dopamine END`
   - **Patch:** Add dopamine trigger on dashboard open

2. **`lib/screens/dashboard/modern_client_dashboard.dart`**
   - **Insertion Location:** After dopamine trigger
   - **Marker Start:** `// âœ… VAGUS ADD: daily-missions START`
   - **Marker End:** `// âœ… VAGUS ADD: daily-missions END`
   - **Patch:** Add daily missions widget

3. **`lib/services/streaks/streak_service.dart`**
   - **Insertion Location:** After streak calculation (in `calculateStreak` method)
   - **Marker Start:** `// âœ… VAGUS ADD: death-spiral-prevention START`
   - **Marker End:** `// âœ… VAGUS ADD: death-spiral-prevention END`
   - **Patch:** Call death spiral prevention service when streak is at risk

#### Feature Flags to Add

**File:** `lib/services/config/feature_flags.dart`

**Add to class constants:**
```dart
// Retention Enhancements
static const String dailyMissions = 'retention_daily_missions';
static const String deathSpiralPrevention = 'retention_death_spiral_prevention';
static const String dailyDopamine = 'retention_daily_dopamine';
```

**Add to `_getDefaultFlags()` method:**
```dart
// Retention Enhancements (default OFF)
dailyMissions: false,
deathSpiralPrevention: false,
dailyDopamine: false,
```

#### Minimal Test Checklist

- [ ] Daily missions generate correctly for each user
- [ ] Daily missions complete and award XP
- [ ] Death spiral prevention detects missed days
- [ ] Death spiral prevention triggers appropriate actions
- [ ] Dopamine triggers on dashboard open
- [ ] Dopamine events log correctly
- [ ] Daily missions integrate with streaks
- [ ] Death spiral prevention integrates with streaks
- [ ] RLS policies prevent unauthorized access
- [ ] Feature flags disable features when OFF

---

### CLUSTER 5: ADMIN â€” Meta-Admin + Compliance/Export + Safety Layer

#### New DB Migration(s)

**File:** `supabase/migrations/YYYYMMDDHHMMSS_admin_god_mode_enhancements.sql`

**Tables/Columns:**
```sql
-- Admin hierarchy (meta-admin)
CREATE TABLE admin_hierarchy (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  admin_id UUID NOT NULL REFERENCES profiles(id),
  parent_admin_id UUID REFERENCES profiles(id), -- NULL for root admin
  admin_level INTEGER NOT NULL CHECK (admin_level >= 1 AND admin_level <= 5),
  permissions JSONB NOT NULL, -- Specific permissions for this admin
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(admin_id)
);

-- Compliance reports
CREATE TABLE compliance_reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_type TEXT NOT NULL CHECK (report_type IN ('gdpr', 'data_export', 'audit', 'user_data')),
  user_id UUID REFERENCES profiles(id), -- NULL for system-wide reports
  report_data JSONB NOT NULL,
  generated_by UUID NOT NULL REFERENCES profiles(id),
  generated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  expires_at TIMESTAMPTZ,
  download_url TEXT
);

-- Safety layer rules
CREATE TABLE safety_layer_rules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  rule_name TEXT NOT NULL UNIQUE,
  rule_type TEXT NOT NULL CHECK (rule_type IN ('prevent', 'warn', 'require_approval')),
  rule_conditions JSONB NOT NULL, -- Conditions that trigger the rule
  rule_action TEXT NOT NULL, -- Action to take
  enabled BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Safety layer audit (logs when safety rules trigger)
CREATE TABLE safety_layer_audit (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  rule_id UUID REFERENCES safety_layer_rules(id),
  admin_id UUID NOT NULL REFERENCES profiles(id),
  action_attempted TEXT NOT NULL,
  action_prevented BOOLEAN DEFAULT false,
  action_data JSONB,
  triggered_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- RLS Policies (admin-only access)
ALTER TABLE admin_hierarchy ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Admins can view admin hierarchy" ON admin_hierarchy FOR SELECT USING (
  EXISTS (SELECT 1 FROM profiles WHERE id = auth.uid() AND role = 'admin')
);

ALTER TABLE compliance_reports ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Admins can view compliance reports" ON compliance_reports FOR SELECT USING (
  EXISTS (SELECT 1 FROM profiles WHERE id = auth.uid() AND role = 'admin')
);

ALTER TABLE safety_layer_rules ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Admins can view safety rules" ON safety_layer_rules FOR SELECT USING (
  EXISTS (SELECT 1 FROM profiles WHERE id = auth.uid() AND role = 'admin')
);

ALTER TABLE safety_layer_audit ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Admins can view safety audit" ON safety_layer_audit FOR SELECT USING (
  EXISTS (SELECT 1 FROM profiles WHERE id = auth.uid() AND role = 'admin')
);
```

#### New Dart Files to Create

1. **`lib/screens/admin/meta_admin_screen.dart`**
   - Screen: `MetaAdminScreen`
   - Features: Manage admin hierarchy, assign admin levels

2. **`lib/services/admin/meta_admin_service.dart`**
   - Class: `MetaAdminService` (singleton)
   - Methods: `getAdminHierarchy()`, `assignAdminLevel()`, `getAdminPermissions()`

3. **`lib/services/admin/compliance_service.dart`**
   - Class: `ComplianceService` (singleton)
   - Methods: `generateGDPRReport()`, `exportUserData()`, `generateAuditReport()`, `getComplianceReports()`

4. **`lib/services/admin/safety_layer_service.dart`**
   - Class: `SafetyLayerService` (singleton)
   - Methods: `checkSafetyRule()`, `preventAction()`, `logSafetyEvent()`, `getSafetyRules()`

#### Existing Files to Patch

1. **`lib/screens/admin/audit_log_screen.dart`**
   - **Insertion Location:** After audit log display
   - **Marker Start:** `// âœ… VAGUS ADD: final-safety-layer START`
   - **Marker End:** `// âœ… VAGUS ADD: final-safety-layer END`
   - **Patch:** Add safety layer monitoring widget

2. **`lib/screens/progress/export_progress_screen.dart`**
   - **Insertion Location:** After export options
   - **Marker Start:** `// âœ… VAGUS ADD: compliance-enhancements START`
   - **Marker End:** `// âœ… VAGUS ADD: compliance-enhancements END`
   - **Patch:** Add compliance export options

3. **`lib/services/admin/admin_service.dart`**
   - **Insertion Location:** Before any admin action (in methods like `updateUserRole`)
   - **Marker Start:** `// âœ… VAGUS ADD: safety-layer-check START`
   - **Marker End:** `// âœ… VAGUS ADD: safety-layer-check END`
   - **Patch:** Add safety layer check before admin actions

#### Feature Flags to Add

**File:** `lib/services/config/feature_flags.dart`

**Add to class constants:**
```dart
// Admin Enhancements
static const String metaAdmin = 'admin_meta_admin';
static const String adminCompliance = 'admin_compliance';
static const String adminSafetyLayer = 'admin_safety_layer';
```

**Add to `_getDefaultFlags()` method:**
```dart
// Admin Enhancements (default OFF)
metaAdmin: false,
adminCompliance: false,
adminSafetyLayer: false,
```

#### Minimal Test Checklist

- [ ] Meta-admin system allows admin hierarchy
- [ ] Admin levels and permissions work correctly
- [ ] Compliance reports generate correctly
- [ ] GDPR reports export user data
- [ ] Safety layer rules prevent dangerous actions
- [ ] Safety layer audit logs all prevented actions
- [ ] Safety layer integrates with existing admin actions
- [ ] RLS policies restrict access to admins only
- [ ] No regressions in existing admin features
- [ ] Feature flags disable features when OFF

---

### CLUSTER 6: VIRAL â€” Passive Virality + Anti-Cringe Safeguards + Viral Analytics

#### New DB Migration(s)

**File:** `supabase/migrations/YYYYMMDDHHMMSS_viral_enhancements.sql`

**Tables/Columns:**
```sql
-- Viral events tracking
CREATE TABLE viral_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id),
  event_type TEXT NOT NULL CHECK (event_type IN ('share', 'referral', 'view', 'click', 'conversion')),
  event_data JSONB NOT NULL,
  source TEXT, -- Where event came from (e.g., 'workout_pr', 'nutrition_plan', 'progress_chart')
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Anti-cringe rules
CREATE TABLE anti_cringe_rules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  rule_name TEXT NOT NULL UNIQUE,
  rule_type TEXT NOT NULL CHECK (rule_type IN ('prevent_share', 'modify_share', 'warn')),
  rule_conditions JSONB NOT NULL,
  rule_action TEXT NOT NULL,
  enabled BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Viral analytics
CREATE TABLE viral_analytics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  date DATE NOT NULL,
  metric_name TEXT NOT NULL, -- e.g., 'shares_per_user', 'referral_rate', 'conversion_rate'
  metric_value DECIMAL NOT NULL,
  metadata JSONB,
  calculated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  UNIQUE(date, metric_name)
);

-- RLS Policies
ALTER TABLE viral_events ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own viral events" ON viral_events FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "System can insert viral events" ON viral_events FOR INSERT WITH CHECK (true); -- System inserts

ALTER TABLE anti_cringe_rules ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Admins can view anti-cringe rules" ON anti_cringe_rules FOR SELECT USING (
  EXISTS (SELECT 1 FROM profiles WHERE id = auth.uid() AND role = 'admin')
);

ALTER TABLE viral_analytics ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Admins can view viral analytics" ON viral_analytics FOR SELECT USING (
  EXISTS (SELECT 1 FROM profiles WHERE id = auth.uid() AND role = 'admin')
);
```

#### New Dart Files to Create

1. **`lib/services/growth/passive_virality_service.dart`**
   - Class: `PassiveViralityService` (singleton)
   - Methods: `triggerPassiveShare()`, `detectShareableMoments()`, `logViralEvent()`

2. **`lib/services/growth/anti_cringe_service.dart`**
   - Class: `AntiCringeService` (singleton)
   - Methods: `checkShareForCringe()`, `modifyShareContent()`, `preventCringeShare()`

3. **`lib/services/growth/viral_analytics_service.dart`**
   - Class: `ViralAnalyticsService` (singleton)
   - Methods: `calculateViralMetrics()`, `getViralTrends()`, `getOptimizationSuggestions()`

4. **`lib/screens/admin/viral_analytics_screen.dart`**
   - Screen: `ViralAnalyticsScreen`
   - Features: View viral metrics, trends, optimization suggestions

#### Existing Files to Patch

1. **`lib/screens/dashboard/modern_client_dashboard.dart`**
   - **Insertion Location:** After dashboard content
   - **Marker Start:** `// âœ… VAGUS ADD: passive-virality START`
   - **Marker End:** `// âœ… VAGUS ADD: passive-virality END`
   - **Patch:** Add passive virality triggers (e.g., after PR, streak milestone)

2. **`lib/services/share/share_card_service.dart`**
   - **Insertion Location:** Before share generation (in `generateShareCard` method)
   - **Marker Start:** `// âœ… VAGUS ADD: anti-cringe-safeguards START`
   - **Marker End:** `// âœ… VAGUS ADD: anti-cringe-safeguards END`
   - **Patch:** Check share content for cringe, modify if needed

3. **`lib/services/growth/referrals_service.dart`**
   - **Insertion Location:** After referral creation (in `recordAttribution` method)
   - **Marker Start:** `// âœ… VAGUS ADD: viral-analytics-tracking START`
   - **Marker End:** `// âœ… VAGUS ADD: viral-analytics-tracking END`
   - **Patch:** Log viral events for analytics

#### Feature Flags to Add

**File:** `lib/services/config/feature_flags.dart`

**Add to class constants:**
```dart
// Viral Enhancements
static const String passiveVirality = 'viral_passive_virality';
static const String antiCringeSafeguards = 'viral_anti_cringe_safeguards';
static const String viralAnalytics = 'viral_analytics';
```

**Add to `_getDefaultFlags()` method:**
```dart
// Viral Enhancements (default OFF)
passiveVirality: false,
antiCringeSafeguards: false,
viralAnalytics: false,
```

#### Minimal Test Checklist

- [ ] Passive virality triggers at appropriate moments
- [ ] Passive virality doesn't feel pushy or annoying
- [ ] Anti-cringe service detects cringe-worthy content
- [ ] Anti-cringe service modifies or prevents cringe shares
- [ ] Viral events log correctly
- [ ] Viral analytics calculate metrics correctly
- [ ] Viral analytics provide optimization suggestions
- [ ] RLS policies prevent unauthorized access
- [ ] No regressions in existing sharing features
- [ ] Feature flags disable features when OFF

---

## E) "BLOCKING QUESTIONS" (MAX 7)

1. **PDF Text Extraction:** The PDF is binary format. Should I use a PDF parsing library (like `pdf_text` package) to extract full numbered enhancements, or do you have a text version? Full extraction requires readable text to identify all numbered items under each section.

2. **Fatigue Tracking Data Source:** For D.VII (Fatigue, Recovery & Readiness), should we integrate with external devices (HRV, sleep trackers) or use manual user input only? The `FatigueIndex` model exists but needs data source clarification.

3. **Daily Missions Generation:** For B.IV (Daily Missions), should missions be AI-generated based on user context, rule-based from templates, or coach-assigned? This affects the `DailyMissionsService` implementation.

4. **Contextual Memory Algorithm:** For G.IV (Contextual Memory Surfacing), what similarity threshold should trigger surfacing? Should it use cosine similarity from embeddings, or a different algorithm?

5. **Safety Layer Rules:** For K.XVI (Final Safety Layer), what specific admin actions should be protected? Should we prevent all destructive actions (user deletion, role changes) or only specific ones?

6. **Passive Virality Triggers:** For J.II (Passive Virality), what specific moments should trigger passive sharing? (PR achievements, streak milestones, progress milestones, etc.) This affects when `PassiveViralityService` activates.

7. **Anti-Cringe Rules:** For J.X (Anti-Cringe Safeguards), what specific content patterns should trigger cringe detection? Should this use AI-based detection or rule-based heuristics?

---

**END OF PRE-IMPLEMENTATION AUDIT**
